rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if false; // TEMPORARY: FOR TESTING ONLY!  
    }
  }
}

// 'true' for testing
// 'false' for release





rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if the current user is an authorized user
    function isSignedInAndAuthorized() {
      return request.auth != null && get(/databases/$(database)/documents/config/access_control).data.all_authorized_uids[request.auth.uid] == true;
    }

    // Helper function to check if the current user has secret access
    function hasSecretAccess() {
      return request.auth != null && get(/databases/$(database)/documents/config/access_control).data.secret_access_uids[request.auth.uid] == true;
    }

    // Rule for the 'config' document itself: Only allow reads by authorized users, no writes
    // This protects your access control list
    match /config/{document=**} {
      allow read: if isSignedInAndAuthorized();
      allow write: if false; // No one should modify this from the client
    }

    // Default rule for most collections: All 5 authorized users can read/write
    match /{path=**} {
      allow read, write: if isSignedInAndAuthorized();
    }

    // Specific rule for the 'secret_data' collection: Only 2 designated users can see
    match /secret_data/{document=**} {
      allow read, write: if hasSecretAccess();
    }
  }
}
