<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IRONCLAD</title>
    <link rel="manifest" href="/IRONCLAD/manifest.json">
    <link rel="apple-touch-icon" href="/IRONCLAD/img/icons/apple-touch-icon.png">
    <link rel="stylesheet" href="/IRONCLAD/css/styles.css">

    <style>
        body {
            text-align: center;
        }

        #log {
            margin-top: 20px;
            text-align: left;
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
            width: -webkit-fill-available;
            max-width: -webkit-fill-available;
        }

        #messages {
            margin-top: 20px;
            text-align: left;
            background: #e0ffe0;
            padding: 10px;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
            width: -webkit-fill-available;
            max-width: -webkit-fill-available;
        }

        button {
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }

        .message-box {
            border: 1px solid #c8e6c9;
            padding: 8px;
            margin-bottom: 5px;
            background-color: #f0fdf0;
            border-radius: 3px;
        }

        .message-title {
            font-weight: bold;
        }

        .message-body {
            font-size: 0.9em;
            color: #333;
        }
    </style>
</head>

<body>
    <header>
        <img src="/IRONCLAD/img/icons/logo.png">
        <h2>Push Notifications</h2>
    </header>

    <main>
        <button id="enableNotificationsButton">Enable Push Notifications</button>

        <p id="featureMessage" style="margin-top: 2rem; font-size: 1.1rem; color: #555;">
            Push Notifications are currently <strong>disabled</strong>.
        </p>

        <div id="log">
            <p><strong>App Log:</strong></p>
        </div>

        <div id="messages">
            <p><strong>Received Messages (Foreground):</strong></p>
        </div>
    </main>
    <footer>
        <button onclick='location.href="/IRONCLAD/pages/home.html" '>Home</button>
    </footer>

    <!-- Firestore Setup -->
    <!--<script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js';
        import { getAuth } from 'https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDUFtZly3OhRSbK1HEItBWwIHpOtzwyvTk",
            authDomain: "ironclad-127a5.firebaseapp.com",
            projectId: "ironclad-127a5",
            storageBucket: "ironclad-127a5.firebasestorage.app",
            messagingSenderId: "57257280088",
            appId: "1:57257280088:web:189e4db32d7ae28523402d",
            measurementId: "G-6RG40RW2YZ"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        // Access Firebase services
        const auth = getAuth(app);
        const db = getFirestore(app);

        // You can now use 'auth' and 'db' for Firebase operations
        // For example, to get a reference to the database:
        // const database = getDatabase(app);
    </script> -->

    <!-- Main application script, using type="module" -->
    
  <!-- Your main application script, using type="module" -->
  <script type="module" src="/IRONCLAD/js/app.js"></script>
  <!--
  -- loaded in firebase-messaging-sw.js via app.js 
  <script type="module" src="/IRONCLAD/js/msgApp.js"></script> -->
  
  <script type="module" src="/IRONCLAD/js/modules.js"></script>

    <!-- Local Database ("Test Mode") -->
    <script src="/IRONCLAD/js/db.js"></script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/IRONCLAD/sw.js', { scope: "/IRONCLAD/" })
                    .then(reg => {
                        console.log('Service Worker registered!', reg);

                        // Optional: nice update prompt
                        reg.addEventListener('updatefound', () => {
                            const newWorker = reg.installing;
                            if (!newWorker) return;

                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log("New: ", newWorker.scriptURL);
                                    console.log("This: ", navigator.serviceWorker.controller.scriptURL)
                                    //if (newWorker.scriptURL == navigator.serviceWorker.controller.scriptURL) {
                                    if (newWorker.scriptURL !== navigator.serviceWorker.controller.scriptURL) {
                                        if (confirm('New version available! Reload to update?')) {
                                            window.location.reload();
                                        }
                                    }
                                }
                            });
                        });
                    })
                    .catch(err => {
                        console.warn('Service Worker registration failed:', err);
                        // This is expected when opening file:// or on insecure origins
                    });
            });

            //navigator.serviceWorker.register('/IRONCLAD/firebase-messaging-sw.js')

        } else {
            console.warn('Service Workers are not supported in this browser');
        }
    </script>

</body>

</html>