<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.1, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="IRONCLAD CRM">
  <meta name="apple-mobile-web-app-status-bar" content="#ffffff">
  <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">

  <!-- Apple Splash Screens (iPad portrait) -->
  <link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="../img/splash/splash-2048x2732.png">
  <link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="../img/splash/splash-1668x2388.png">
  <link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="../img/splash/splash-1536x2048.png">

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="../favicon.png">
  <link rel="icon" type="image/png" href="../favicon.png">
  <link rel="shortcut icon" href="../favicon.png">

  <link rel="manifest" href="../manifest.json">
  <link rel="apple-touch-icon" href="../img/icons/apple-touch-icon.png">
  <link rel="stylesheet" href="../css/styles.css">

  <title>IRONCLAD CRM</title>
</head>

<body>
    <header>
        <img src="../img/icons/logo.png">
        <h2>Structure</h2>
    </header>

    <main>
        <!-- Toggle Switch -->
        <!-- <div class="toggle-container full">
            <label class="switch">
                <input type="checkbox" id="roofInclude" data-target="roof-form">
                <span class="slider round"></span>
            </label>
            <span class="toggle-label">Roof</span>
            <span class="status" id="status">Not Included</span>
        </div> -->
        <div class="application-content">
            <form id="facet-form">
                <table>
                    <tdata>
                        <tr>
                            <th><span id="structure">Structure</span></th>
                            <th><span id="facet">Facet</span></th>
                        </tr>
                        <tr>
                            <td><span>Type</span></td>
                            <td><select name="category">
                                    <option>Shingle</option>
                                    <option>Metal</option>
                                    <option>Flat</option>
                                </select></td>
                        </tr>
                        <tr>
                            <td><span>Size (sq.)</span></td>
                            <td><input name="size" placeholder="0" type="number">
                            </td>
                        </tr>
                        <tr>
                            <td><span>Pitch</span></td>
                            <td><select name="pitch">
                                    <option>0 - 2/12</option>
                                    <option>2/12 - 3/12</option>
                                    <option>4/12 - 7/12</option>
                                    <option>8/12 - 9/12</option>
                                    <option>10/12 - 11/12</option>
                                    <option>12/12 - 13/12</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td><span>Tearoff</span></td>
                            <td><select name="layers">
                                    <option>None</option>
                                    <option>1-Layer</option>
                                    <option>2-Layer</option>
                                    <option>3-Layer</option>
                                    <option>4-Layer</option>
                                    <option>5-Layer</option>
                                </select></td>
                        </tr>
                        <tr>
                            <td><span>Sheathing</span></td>
                            <td><select name="sheathing">
                                    <option>Wood Board</option>
                                    <option>OSB / Plywood</option>
                            </td>
                        </tr>
                    </tdata>
                </table>
                <!--<button>Next Facet</button>-->
            </form>
            <br>
            <br>
        </div>

        <p style="color: rgb(100, 100, 100);">Use the form(s) below to configure each of the structures/facets defined in the previous screen</p>
    </main>

    <footer>
        <div class="bottom-nav">
            <button class="" onclick="goToPage('/calculator.html')">◄ Back</button>
            <button class="" onclick="goToPage(location.href='/home.html')">Next ►</button>
        </div>
    </footer>


    <!-- Firestore Database ("Live") -->
    <script type="module" src="../js/modules.js"></script>
  
    <!-- Local Database ("Test Mode") -->
    <script src="/IRONCLAD/js/db.js"></script>
  
    <!-- Link JavaScript -->
    <script src="/IRONCLAD/js/app.js"></script>


    <!-- Page JavaScript -->
    <script>
        // Clone table form
        function cloneForm(name, structure, facet) {
            // 1. Select the original element
            const originalForm = document.querySelector('.application-content');

            // 2. Clone the element deeply (with children)
            const clonedForm = originalForm.cloneNode(true);

            // 3. Modify the clone's ID to ensure uniqueness
            // You might want a more sophisticated way to generate unique IDs in a real application
            clonedForm.id = name;
            var headers = clonedForm.querySelectorAll('th');
            headers[0].innerText = structure;
            headers[1].innerText = facet;

            // 4. Insert the clone into the DOM (append to the list)
            const main = document.querySelector('main');
            main.appendChild(clonedForm);
        }

        var x = 0;
        db.collection('roof_facets').onSnapshot(snapshot => {
            //console.log(snapshot);
            let changes = snapshot.docChanges();

            changes.forEach(change => {
                /*if (change.type == 'added') {
                    renderRoof(change.doc);
                } else if (change.type == 'removed') {
                    let li = roofForm.querySelector('[data-id=' + change.doc.id + ']');
                    roofForm.removeChild(li);
                }*/
               cloneForm(change.doc.id, change.doc.data().structure, change.doc.data().facet);
               console.log(changes[x].doc.data(), changes[x].doc.data().facet);
               x = x + 1;
            });
        });

        var originalForm = document.querySelector('.application-content');
        originalForm.parentNode.removeChild(originalForm);

    </script>

</body>

</html>